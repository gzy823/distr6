<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R6 and Design Patterns • distr6</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="R6 and Design Patterns">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">distr6</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    OOP and R6
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/oop_and_design_patterns.html">OOP and Design Patterns</a>
    </li>
    <li>
      <a href="../articles/r6_and_design_patterns.html">R6 and Design Patterns</a>
    </li>
    <li>
      <a href="../articles/documentation_in_r6.html">Documentation in R6</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    API and Design
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analytic_and_numeric_methods.html">Analytic and Numeric Methods</a>
    </li>
    <li>
      <a href="../articles/api_lifecycle.html">API Lifecycle</a>
    </li>
    <li>
      <a href="../articles/roadmap.html">Roadmap</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial_overview_to_distr6_v0.html">Overview to distr6 v0</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/RaphaelS1/distr6">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>R6 and Design Patterns</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RaphaelS1/distr6/blob/master/vignettes/r6_and_design_patterns.rmd"><code>vignettes/r6_and_design_patterns.rmd</code></a></small>
      <div class="hidden name"><code>r6_and_design_patterns.rmd</code></div>

    </div>

    
    
<p>Despite R6 becoming more commonplace in R packages, we have found no documentation of best practices for using R6 and object-oriented programming (OOP) methods and design patterns. Hence we propose our own R6 snippets and workarounds for common design patterns and other OOP methods. We have implemented the following OOP processes and design patterns thus far:</p>
<ol style="list-style-type: decimal">
<li><a href="#abstract-classes">Abstract Classes</a></li>
<li><a href="#decorators">Decorators</a></li>
</ol>
<div id="abstract-classes" class="section level3">
<h3 class="hasAnchor">
<a href="#abstract-classes" class="anchor"></a>Abstract Classes</h3>
<p>Abstract classes are classes that cannot be instantiated. They are useful for defining hierarchical structures and inheritance in OOP. As well as for the Abstract Factory design pattern.</p>
<p>Implementation: In R6, all classes are concrete and by default have an <code>initialize</code> method for construction. Therefore to make a class abstract we overload the <code>initialize</code> method as follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span>AbstractClass<span class="op">$</span><span class="kw">set</span>(<span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="cf">function</span>(){</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="op">+</span><span class="st">   </span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(RSmisc<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/RSmisc/man/getR6Class.html">getR6Class</a></span>(self), <span class="st">"is an abstract class that can't be initialized."</span>))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="op">+</span><span class="st"> </span>})</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># So on construction</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="op">&gt;</span><span class="st"> </span>AbstractClass<span class="op">$</span><span class="kw">new</span>()</a></code></pre></div>
<pre><code>Error in .subset2(public_bind_env, "initialize")(...) : 
  AbstractClass is an abstract class that can't be initialized.</code></pre>
<hr>
</div>
<div id="decorators" class="section level3">
<h3 class="hasAnchor">
<a href="#decorators" class="anchor"></a>Decorators</h3>
<p>From Gamma et al.:</p>
<blockquote>
<p>“(Decorators) Attach additional responsibilities to an objects dynamically. Decorators provide a flexible alternative to subclassing for extending functionality.”</p>
</blockquote>
<p>Implementation: Decorators are particularly complex in R6 for a number of reasons. Firstly inheritance occurs in the class definition and not object definition, therefore we cannot dynamically choose which class to inherit from. Secondly, methods and variables should only be defined before initializing an object and any defined after do not have access to the object itself (i.e. the ‘self’ and ‘private’ accessors). And finally there is no simple way to reference one object dynamically from another without this being hardcoded. Implementation has two key methods, the first via construction of the class to be decorated and secondly via construction of the decorator assuming an object has already been instantiated to decorate it.</p>
<p><strong>Method 1)</strong> In the class to decorate we copy every public method from the decorators of interest to the class and we add <code>self</code> as an argument to ensure that the decorator methods have the same access level as ‘standard’ methods.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(decorators)){</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(decorators,<span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">      methods &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(x<span class="op">$</span>public_methods, <span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(x<span class="op">$</span>inherit))<span class="op">$</span>public_methods) <span class="co"># Combines decorator methods and any parent methods</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">      methods &lt;-<span class="st"> </span>methods[<span class="op">!</span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(methods) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"initialize"</span>,<span class="st">"clone"</span>))] <span class="co"># Ensures initialize and clone aren't copied</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">      aself &lt;-<span class="st"> </span>self</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">      <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(methods)){</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">          <span class="kw"><a href="https://rdrr.io/r/base/formals.html">formals</a></span>(methods[[i]] ) =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/formals.html">formals</a></span>(methods[[i]]),<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">self=</span>aself)) <span class="co"># Adds self as default to every decorator ensuring access to the object</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">          <span class="kw"><a href="https://rdrr.io/r/base/assign.html">assign</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(methods)[[i]],methods[[i]],<span class="dt">envir=</span><span class="kw"><a href="https://rdrr.io/r/base/as.environment.html">as.environment</a></span>(self)) <span class="co"># Copies every method from the decorator to the object</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">      }</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    })</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">  private<span class="op">$</span>.decorators =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(decorators,<span class="cf">function</span>(x) x[[<span class="st">"classname"</span>]]))</a></code></pre></div>
<p>where we assume <code>decorators</code> is an argument to the constructor given as a list naming the decorator classes and that a private variable called <code>.decorators</code> is a list of decorators already present in the object.</p>
<p><strong>Method 2)</strong> On construction of a particular decorator, the original object is overwritten with whichever decorators were already added and the new decorator that is being constructed. The decorator object is not saved to local memory.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">DistributionDecorator<span class="op">$</span><span class="kw">set</span>(<span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="cf">function</span>(distribution){</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="cf">if</span>(<span class="kw">getR6Class</span>(self) <span class="op">==</span><span class="st"> "DistributionDecorator"</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw">getR6Class</span>(self), <span class="st">"is an abstract class that can't be initialized."</span>)) <span class="co"># Defines the Abstract Decorator parent class as abstract.</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  decorators =<span class="st"> </span>distribution<span class="op">$</span><span class="kw">decorators</span>() <span class="co"># Gets decorator list from object.</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(decorators)){</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    decorators =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(decorators,get)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  decorators =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(decorators,<span class="kw"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="kw">getR6Class</span>(self)))) <span class="co"># Combines decorators present in the object with the current decorator to be added.</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">  <span class="kw"><a href="https://rdrr.io/r/base/assign.html">assign</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span>(distribution)), Distribution<span class="op">$</span><span class="kw">new</span>(distribution)), pos =<span class="st"> </span>.GlobalEnv<span class="er">)</span> <span class="co"># Constructs a new object via Method 1) and assigns this to the environment with the same name as the undecorated object.</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">  <span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span>(distribution),<span class="st">"is now decorated with"</span>,<span class="kw">getR6Class</span>(self),<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>))</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">})</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Raphael Sonabend, Franz Kiraly.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
