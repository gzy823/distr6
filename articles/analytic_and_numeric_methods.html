<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Decorators, Analytic and Numeric Methods • distr6</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Decorators, Analytic and Numeric Methods">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">distr6</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    OOP and R6
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/oop_and_design_patterns.html">OOP and Design Patterns</a>
    </li>
    <li>
      <a href="../articles/r6_and_design_patterns.html">R6 and Design Patterns</a>
    </li>
    <li>
      <a href="../articles/documentation_in_r6.html">Documentation in R6</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    API and Design
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/analytic_and_numeric_methods.html">Analytic and Numeric Methods</a>
    </li>
    <li>
      <a href="../articles/api_lifecycle.html">API Lifecycle</a>
    </li>
    <li>
      <a href="../articles/roadmap.html">Roadmap</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial_overview_to_distr6_v0.html">Overview to distr6 v0</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/RaphaelS1/distr6">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Decorators, Analytic and Numeric Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RaphaelS1/distr6/blob/master/vignettes/analytic_and_numeric_methods.rmd"><code>vignettes/analytic_and_numeric_methods.rmd</code></a></small>
      <div class="hidden name"><code>analytic_and_numeric_methods.rmd</code></div>

    </div>

    
    
<pre><code>## 
##   
   checking for file ‘/tmp/RtmpnsNSqd/remotes376c17bd35d9/alan-turing-institute-distr6-18864ee/DESCRIPTION’ ...
  
✔  checking for file ‘/tmp/RtmpnsNSqd/remotes376c17bd35d9/alan-turing-institute-distr6-18864ee/DESCRIPTION’
## 
  
─  preparing ‘distr6’:
## 
  
   checking DESCRIPTION meta-information ...
  
✔  checking DESCRIPTION meta-information
## 
  
─  checking for LF line-endings in source and make files and shell scripts
## 
  
─  checking for empty or unneeded directories
## 
  
─  building ‘distr6_0.1.0.9000.tar.gz’
## 
  
   
## </code></pre>
<p>distr6 operates under a strict rule that implemented distributions, of class <code>SDistribution</code>, and similarly implemented kernel, of class <code>Kernel</code>, should only contain analytic methods. This ensures that all results are as precise as possible and ensure optimal efficiency. The figure below gives a visual representation of how this looks. Moreover we further minimise error by restricting any possible numeric calculations such as in Beta or Gamma functions to only methods implemented in R stats, such as <code>beta</code> and <code>gamma</code>, or in the <code>pracma</code> package. For distributions where no closed form analytic expression can be found, details of this are found in the ‘Details’ section of the distribution’s help page. To impute numeric results, decorators are used.</p>
<p><img src="decorators.png"></p>
<p>Currently distr6 has three decorators:</p>
<ol style="list-style-type: decimal">
<li><code>CoreStatistics</code></li>
<li><code>ExoticStatistics</code></li>
<li><code>FunctionImputation</code></li>
</ol>
<p><code>CoreStatistics</code> contains all commonly used mathematical and statistical functions used to describe a probability distribution, for example: expectation, variance, kurtosis and skewness. In addition there is a generalised expectation function <code>genExp</code> that can be used to find any generic expectation of the distribution of the form <span class="math inline">\(E[f(X)]\)</span> where <span class="math inline">\(f(X)\)</span> can be any function acting on <span class="math inline">\(X\)</span>. This is particularly useful for more complex functions such as <code>kthmoment</code>.</p>
<p><code>ExoticStatistics</code> contains less commonly used functions for the general user but useful functions for modelling and survival analysis. These include survival, hazard and any p-norm of pdf.</p>
<p><code>FunctionImputation</code> imputes the pdf/cdf/quantile/random using numerical methods, depending which are provided. These follow a strict hierarchy to maximise efficiency and minimise error from numerical approximations. The hierarchy is as follows:</p>
<ul>
<li>To impute the pdf: <code>cdf2pdf</code>; <code>rand2pdf</code>; <code>quantile2pdf</code>
</li>
<li>To impute the cdf: <code>quantile2cdf</code>; <code>pdf2cdf</code>; <code>rand2cdf</code>
</li>
<li>To impute the quantile: <code>cdf2quantile</code>; <code>pdf2quantile</code>; <code>rand2quantile</code>
</li>
<li>To impute the rand: <code>quantile2rand</code>; <code>cdf2rand</code>; <code>pdf2rand</code>
</li>
</ul>
<div id="how-to-decorate" class="section level2">
<h2 class="hasAnchor">
<a href="#how-to-decorate" class="anchor"></a>How to Decorate</h2>
<p>Decorators can be added to a distribution in one of three ways depending on whether the decorator should be added in construction or not.</p>
<div id="method-1-in-construction" class="section level3">
<h3 class="hasAnchor">
<a href="#method-1-in-construction" class="anchor"></a>Method 1: In Construction</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">Normal<span class="op">$</span><span class="kw">new</span>(<span class="dt">var =</span> <span class="dv">1</span>, <span class="dt">decorators =</span> CoreStatistics) <span class="co"># For one only</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">Normal<span class="op">$</span><span class="kw">new</span>(<span class="dt">var =</span> <span class="dv">1</span>, <span class="dt">decorators =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(CoreStatistics, ExoticStatistics)) <span class="co"># For multiple</span></a></code></pre></div>
</div>
<div id="method-2-after-construction-construct-a-decorator" class="section level3">
<h3 class="hasAnchor">
<a href="#method-2-after-construction-construct-a-decorator" class="anchor"></a>Method 2: After Construction, Construct a Decorator</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">n &lt;-<span class="st"> </span>Normal<span class="op">$</span><span class="kw">new</span>(<span class="dt">var =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">n<span class="op">$</span><span class="kw">pdfPNorm</span>(<span class="dv">2</span>) <span class="co"># Error as it hasn't been decorated</span></a></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): attempt to apply non-function</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">n &lt;-<span class="st"> </span>Normal<span class="op">$</span><span class="kw">new</span>(<span class="dt">var =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">ExoticStatistics<span class="op">$</span><span class="kw">new</span>(n)</a></code></pre></div>
<pre><code>## dist is now decorated with ExoticStatistics</code></pre>
<pre><code>## &lt;ExoticStatistics&gt;
##   Inherits from: &lt;DistributionDecorator&gt;
##   Public:
##     cdfAntiDeriv: function (lower = NULL, upper = NULL) 
##     cdfPNorm: function (p = 2, lower = NULL, upper = NULL) 
##     clone: function (deep = FALSE) 
##     cumHazard: function (x1, log = FALSE) 
##     hazard: function (x1, log = FALSE) 
##     initialize: function (dist) 
##     pdfPNorm: function (p = 2, lower = NULL, upper = NULL) 
##     survival: function (x1, log.p = FALSE) 
##     survivalAntiDeriv: function (lower = NULL, upper = NULL) 
##     survivalPNorm: function (p = 2, lower = NULL, upper = NULL)</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">n<span class="op">$</span><span class="kw">pdfPNorm</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## Warning in generalPNorm(self$pdf, p, lower, upper): Results from numeric
## calculations are approximate only. Better results may be available.</code></pre>
<pre><code>## [1] 0.531126</code></pre>
</div>
<div id="method-3-after-construction-use-decorate" class="section level3">
<h3 class="hasAnchor">
<a href="#method-3-after-construction-use-decorate" class="anchor"></a>Method 3: After Construction, Use <code>decorate</code>
</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">n &lt;-<span class="st"> </span>Normal<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">n<span class="op">$</span><span class="kw">kthmoment</span>(<span class="dv">4</span>, <span class="st">"raw"</span>) <span class="co"># Error as it hasn't been decorated</span></a></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): attempt to apply non-function</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">decorate</span>(n, CoreStatistics)</a></code></pre></div>
<pre><code>## n is now decorated with CoreStatistics</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">n<span class="op">$</span><span class="kw">kthmoment</span>(<span class="dv">4</span>, <span class="st">"raw"</span>)</a></code></pre></div>
<pre><code>## Results from numerical integration are approximate only, better results may be available.</code></pre>
<pre><code>## [1] 3</code></pre>
<p>When a decorator is constructed, either in construction of a <code>Distribution</code> or after, only the functions that do not exist analytically are added. For example, if a distribution has an analytic <code>variance</code> function as part of its core interface, then this will not be overloaded by the <code>CoreStatistics</code> decorator.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">n &lt;-<span class="st"> </span>Normal<span class="op">$</span><span class="kw">new</span>(<span class="dt">decorators =</span> CoreStatistics)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">n<span class="op">$</span>mean <span class="co"># The analytic method</span></a></code></pre></div>
<pre><code>## function () 
## {
##     return(self$getParameterValue("mean"))
## }
## &lt;environment: 0x70d85f0&gt;</code></pre>
<p>Similarly where possible an analytic method is always preferred. For example, if an analytic <code>cdf</code> expression is available, then the <code>survival</code> function in <code>ExoticStatistics</code> is defined as <code>1 - cdf</code> otherwise a numerical integration is calculated.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">n &lt;-<span class="st"> </span>Normal<span class="op">$</span><span class="kw">new</span>(<span class="dt">decorators =</span> ExoticStatistics)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">n<span class="op">$</span><span class="kw">survival</span>(<span class="dv">2</span>) <span class="op">==</span><span class="st"> </span>n<span class="op">$</span><span class="kw">cdf</span>(<span class="dv">2</span>, <span class="dt">lower.tail =</span> F) <span class="co"># The analytic method</span></a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Finally, even if an analytic expression for <code>expectation</code> exists, the <code>CoreStatistics</code> decorator always adds a <code>genExp</code> method for a generalised numerical expectation formula, this is required for numerical results for variance, moments, etc.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#how-to-decorate">How to Decorate</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Raphael Sonabend, Franz Kiraly.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
